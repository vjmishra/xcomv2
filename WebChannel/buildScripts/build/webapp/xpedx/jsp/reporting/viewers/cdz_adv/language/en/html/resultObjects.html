<!--
=============================================================
WebIntelligence(r) Report Panel
Copyright(c) 2001-2005 Business Objects S.A.
All rights reserved

Use and support of this software is governed by the terms
and conditions of the software license agreement and support
policy of Business Objects S.A. and/or its subsidiaries. 
The Business Objects products and technology are protected
by the US patent number 5,555,403 and 6,247,008

=============================================================
--><!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<style type="text/css">
#varsToolbar{position:absolute;top:0;left:0px;overflow:hidden;}
#dicTree{position:absolute;top:25px;left:0px;}
</style>
<script language="javascript" src="../../../lib/dom.js"></script>
<script language="javascript" src="../../../lib/menu.js"></script>
<script language="javascript" src="../../../lib/palette.js"></script>
<script language="javascript" src="../../../lib/treeview.js"></script>
<script language="javascript" src="../../../scripts/CommonWom.js"></script>
<script language="javascript">
p = parent
initDom("../../../lib/images/"+p._skinName+"/", p._lang)
initTooltipWin(p)
p.setKeyCB(this, false)
</script>     
<script language="javascript">styleSheet()</script>
<script language="javascript">
isPageLoaded = false        
var url =  p._root + "incObjects" + p._appExt
url += p.urlParamsNoBID()
includeScript(url) 
</script>
<script language="javascript">
 _error = (window._isSessionInvalid || !window.incObjectsOK)
 newTreeElt1 = null
 newTreeElt2 = null
 newTreeElt3 = null
if (window._isSessionInvalid) {
p.alertSessionInvalid()
} else if (window.incObjectsOK) {
dirImg = getBasePath()+'../../../images/main/'
varsToolbar = newPaletteWidget("varsToolbar")
curIcon="formula.gif"
_img = '../../../images/main/'
_useVariables = p.isEnableUserRight(p._usrUseFormula)
_showToolbar = p.isEnableUserRight(p._usrUseFormula) || p.isEnableUserRight(p._usrCreateMergeDimension)
_toolbarYOffset = _showToolbar?25:0
insertBt = addCheckIcn("insertBt",null,"Insert","Insert a result object in the report", insertCB)
if (_useVariables && p.isEnableUserRight(p._usrCreateMergeDimension)) sp()
mergeDimBt = addIcn("mergeDimBt",7,"Merge","Merge the selected dimensions into a merged dimension", mergeCB)
if (_useVariables) sp()
varsIconMenu=addIcnM("varsIconMenu",5,"Variable","Create, edit and remove variables", addFormulaCB)
dictContextMenu=menu=varsIconMenu.getMenu()
dictContextMenu.beforeShowCB=initDictContextMenu
addMenu=menu.add("dictAdd","New", addFormulaCB,_img+"formula.gif",5*16,0,false,5*16,16);
editMenu=menu.add("dictEdit","Edit", editFormulaCB,_img+"formula.gif",6*16,0,false,6*16,16);
mergePropMenu=menu.add("mergeProp","Edit Properties", mergePropCB);
rmMenu=menu.add("dictRemove","Remove", rmFormulaCB, _img+"formula.gif",16,0,false,16,16);
resultObjectsContextMenu=p.newMenu("resultObjectsContextMenu",initResultObjectsContextMenu);
addContextMenu=resultObjectsContextMenu.add("dictAddC","New", "formula", 5, addFormulaCB);
editContextMenu=resultObjectsContextMenu.add("dictEditC","Edit", "formula", 6, editFormulaCB);
mergePropContextMenu=resultObjectsContextMenu.add("mergePropC","Edit Properties", null, 0, mergePropCB);
rmContextMenu=resultObjectsContextMenu.add("dictRemoveC","Remove", "formula", 1, rmFormulaCB);
dicTree = newTreeWidget('dicTree', 160, 280, dirImg + "qualificationIcons.gif", clickCB, dclickCB, "dialogzone",expCollapseCB,expCollapseCB,deleteCB)
dicTree.setTooltipOnMouseOver(true) 
dicTree.setMultiSelection(true)
dicTree.setDragDrop(startDragCB,acceptDropCB,dropCB,dragEndCB)
if (p.isEnableUserRight(p._usrShowRightClickMenu)) {
dicTree.setRightClickMenuCB(showContextMenu)
}
}
function initDictContextMenu()
{
editMenu.setDisabled(true)
mergePropMenu.setDisabled(true)
rmMenu.setDisabled(true)
addMenu.setDisabled(false)
var sel=dicTree.getSelections()
if (sel.length == 1)
{
_data=sel[0].userData
var name=sel[0].name
if (_data) {
if (_data.isVariable) {
editMenu.setDisabled(false)
rmMenu.setDisabled(false)
} else if (_data.DPNames) {
mergePropMenu.setDisabled(false)
}
} 
}
p.initUserRight(addMenu,p._usrUseFormula);
p.initUserRight(editMenu,p._usrUseFormula);
p.initUserRight(rmMenu,p._usrUseFormula);
p.initUserRight(mergePropMenu,p._usrCreateMergeDimension)
}
function initResultObjectsContextMenu()
{
editContextMenu.setDisabled(true)
mergePropContextMenu.setDisabled(true)
rmContextMenu.setDisabled(true)
addContextMenu.setDisabled(false)
var sel=dicTree.getSelections()
if (sel.length == 1)
{
_data=sel[0].userData
var name=sel[0].name
if (_data) {
if (_data.isVariable) {
editContextMenu.setDisabled(false)
rmContextMenu.setDisabled(false)
} else if (_data.DPNames) {
mergePropContextMenu.setDisabled(false)
}
} 
}
p.initUserRight(addContextMenu,p._usrUseFormula);
p.initUserRight(editContextMenu,p._usrUseFormula);
p.initUserRight(rmContextMenu,p._usrUseFormula);
p.initUserRight(mergePropContextMenu,p._usrCreateMergeDimension)
}
function insertCB()
{
p.escapeFormatPainter()
p._DDIconUrl= p._img + "qualificationIcons.gif"
p._DDIdx= currentIconId
p._isDDEnabled=insertBt.isChecked()
}
        function expCollapseCB()
        {
p._resultObjsBranchExp = (newTreeElt1)? newTreeElt1.expanded : false
p._varsBranchExp = (newTreeElt2)? newTreeElt2.expanded : false
p._formulaeBranchExp = (newTreeElt3)? newTreeElt3.expanded : false
}
        function clickCB()
        {
p.escapeFormatPainter()
        var items = dicTree.getSelections()
currentIconId=0
        if (items.length == 1) 
        {       
        _singleSel  = items[0]   
        currentIconId = items[0].iconId
        setMatchDPName(dicTree.sub[0], "", true, true)
           if ((_singleSel.par) && (_singleSel.userData) && !(_singleSel.userData.isFormula) && !(_singleSel.userData.isVariable)) {
           _singleSel.setGrayStyle(!_singleSel.isGrayStyle())
           switch (_singleSel.userData.kind)
           {       
           case _dim :
           case _dtl :
           var DPName = _singleSel.userData.DPName           
           setMatchDPName(dicTree.sub[0], DPName, false, false)
           break;
           case _linkDim : 
           setMatchDPName(dicTree.sub[0], "", true, false)         
        for (var k=0; k < _singleSel.userData.DPNames.length; k++) {                
        var DPName = _singleSel.userData.DPNames[k]
           setMatchDPName(dicTree.sub[0], DPName, false, true)                     
        }
           break;
           case _msr :                               
           case _variable :
           case _formula :
}
           }
        } 
updateBtns()
        }
        function setMatchDPName(subTree, DPName, deselectAll, setOnly) {
   var subTreeCount = subTree.sub.length
        for (var j=0; j < subTreeCount; j++)
        {                  
        obj = subTree.sub[j]                
        if (deselectAll) {
        obj.setGrayStyle(false)
        }
        if ((obj.userData != null) && (obj.userData.kind != _msr))  {
        if (obj.userData.kind == _linkDim) {
        var matchOneDP = false
        for (var m=0; m < obj.userData.DPNames.length; m++) {        
        if (DPName == obj.userData.DPNames[m]) {
        matchOneDP = true
        break
        }                        
        }
        if (setOnly) {
        if (matchOneDP) obj.setGrayStyle(false)
        } else {
        obj.setGrayStyle(!matchOneDP)
        }        
        } else {
        if (setOnly) {
        if (DPName == obj.userData.DPName) obj.setGrayStyle(false)
        } else {
        obj.setGrayStyle(DPName != obj.userData.DPName)
        }
        }
        }
        if (obj.sub.length) setMatchDPName(obj, DPName, deselectAll, setOnly)
        }
        }
        function loadCB()
        {
if (_error)
{
p.hideBlockWhileWaitWidget();
return
}
isPageLoaded = true
resultObjectsContextMenu.init();
p.initUserRight(resultObjectsContextMenu,p._usrUseFormula);
if (_showToolbar) {
varsToolbar.init()
insertBt.init()
mergeDimBt.init()
varsIconMenu.init()
p.initUserRight(insertBt,p._usrUseFormula);
p.initUserRight(mergeDimBt,p._usrCreateMergeDimension);
p.initUserRight(varsIconMenu,p._usrUseFormula);
p.DDInitMethod=DDInitAction
p.DDActionMethod=DDExecuteAction
updateDocumentObs1 = p.newObserverOneEvent(p._EVT_ESC_KEY, updateInsertBt)
}
dicTree.init()
buildTree(dicTree,true)
resizeCB()
p.hideBlockWhileWaitWidget();
    }
function updateInsertBt()
{
p._isDDEnabled=false
var fr=getTopFrameset(self).getReportFrame()
showFeedbackElem(fr.document,false)
insertBt.check(false)
}
function detachEvents()
{
p._isDDEnabled=false
if (window.updateDocumentObs1) p.eventManager.detach(updateDocumentObs1);
}
    function startDragCB()
    {
setTooltipOffset(p.leftPaneX+1,p.leftPaneY+28)
p._accepDDfunc=reportAcceptDropCB
p._dropDDfunc=reportDropCB
    }
    function dragEndCB()
    {
p._accepDDfunc=null
p._dropDDfunc=null
fr=getTopFrameset(self).getReportFrame(),d=fr.document
showFeedbackElem(d,false)
    }
    function acceptDropCB()
    {
return false
    }
    function dropCB()
    {
    }
    function getFeebackElem(d)
    {
var feedElem=d.getElementById("__DD_Feedback")
if (feedElem==null)
{
feedElem=d.createElement("DIV")
feedElem.id="__DD_Feedback"
feedElem.ondragover=FeedDragOver
feedElem.ondrop=FeedDrop
feedElem.ondragleave=FeedDragLeave
feedElem.onmousedown=DDExecuteAction
feedElem.onmousemove=p.mmove
var css=feedElem.style
css.backgroundColor="#195FA0"
css.border="1px solid white"
css.position="absolute"
css.overflow="hidden"
css.zIndex=5000
d.body.appendChild(feedElem)
setLayerTransp(feedElem,60)
}
return feedElem
    }
function FeedDragOver()
{
var e=getTopFrameset(self).getReportFrame().event
if (e.dataTransfer) {
e.dataTransfer.dropEffect=((_zone!=p._cellContent)&&(_cn!="reportCell")&&(_cn!="cell"))?'copy':'move'
}
e.returnValue=false
return false
}
function FeedDrop()
{
reportDropCB(_lyr,_cn,_zone)
}
function FeedDragLeave()
{
this.style.display="none"
}
    function showFeedbackElem(d,show,x,y,w,h,lyr,cn,zone)
    {
var feedElem=getFeebackElem(d)
var css=feedElem.style
if (show)
{
if (_moz)
{
x-=1
y-=1
w=Math.max(0,w-2)
h=Math.max(0,h-2)
}
css.display="block"
css.top    = ""+p.convertY(y)+"px"
css.left   = ""+p.convertX(x)+"px"
css.width  = ""+(p.convertWidth(w)+1)+"px"
css.height = ""+(p.convertHeight(h)+1)+"px"
} else {
css.display="none"
}
    }
function getBord(lyr,side)
{
var st=lyr.currentStyle
if (st['border'+side+'Style']=="none")
return 0
else
{
var w=parseInt(st['border'+side+'Width'])
return isNaN(w)?0:w
}
}
    _lyr=_cn=_zone=null
    function canDragDrop()
    {
var selItems=dicTree.getSelections()
if (selItems==null) return false
var lSelItems = selItems.length
if (lSelItems == 0) return false
for (var i=0; i < lSelItems; i++)
{
if ((selItems[i] == null) || (selItems[i].userData == null) || !(selItems[i].userData.id)) return false
}
return true
    }
    function reportAcceptDropCB(lyr,cn,zone,isDDEmulation)
    {
isRealDD=isDDEmulation?false:true
    var bid=lyr.getAttribute?lyr.getAttribute("bid"):null
if (bid == null) return false
var fr=getTopFrameset(self).getReportFrame(),d=fr.document
var e=fr.event
var fWidth=p._ddMargH 
var fHeight=p._ddMargV 
var selItems=dicTree.getSelections()
if (selItems==null) return false
var lSelItems = selItems.length
if (lSelItems == 0) return false
var isSingleSelection = (lSelItems == 1)
if (!canDragDrop())
return false
_selTxt = isSingleSelection?(selItems[0].getDragTooltip()):""
if (mergeAction && mergeAction=="merge" && !mergeDimBt.isDisabled()) return false
_lyr=lyr
_cn=cn
_zone=zone
if (cn=="tableCell")
{
if (!isSingleSelection) return false
if (isRealDD && e.dataTransfer) {
e.dataTransfer.dropEffect=(_zone!=p._cellContent)?'copy':'move'
}
p.deselectAll()
switch(zone)
{
case p._cellBottom:
fHeight=Math.min(fHeight,lyr.offsetHeight)
showFeedbackElem(d,true,
getPos(lyr).x,
getPos(lyr).y+lyr.offsetHeight-fHeight,
lyr.offsetWidth,
fHeight,
lyr,cn,zone)
break
case p._cellTop:
fHeight=Math.min(fHeight,lyr.offsetHeight)
showFeedbackElem(d,true,
getPos(lyr).x,
getPos(lyr).y,
lyr.offsetWidth,
fHeight,
lyr,cn,zone)
break
case p._cellLeft:
fWidth=Math.min(fWidth,lyr.offsetWidth)
showFeedbackElem(d,true,
getPos(lyr).x,
getPos(lyr).y,
fWidth,
lyr.offsetHeight,
lyr,cn,zone)
break
case p._cellRight:
fWidth=Math.min(fWidth,lyr.offsetWidth)
showFeedbackElem(d,true,
getPos(lyr).x+lyr.offsetWidth-fWidth,
getPos(lyr).y,
fWidth,
lyr.offsetHeight,
lyr,cn,zone)
break
case p._cellContent:
showFeedbackElem(d,true,
getPos(lyr).x+fWidth,
getPos(lyr).y+fHeight,
Math.max(0,lyr.offsetWidth-2*fWidth),
Math.max(0,lyr.offsetHeight-2*fHeight),
lyr,cn,zone)
break
default:
showFeedbackElem(d,false)
break
}
return true
}
switch (cn)
{
case "cell":
case "reportCell":
if (!isSingleSelection) return false
p.deselectAll()
var elt = p.findByBID(p.doc,bid)
if ((selItems[0].userData.kind == p._msr) && (elt.isSect)) return false
showFeedbackElem(d,true,
getPos(lyr).x,
getPos(lyr).y,
Math.max(0,lyr.offsetWidth),
Math.max(0,lyr.offsetHeight),
lyr,cn,zone)
if (isRealDD && e.dataTransfer) {
e.dataTransfer.dropEffect='move'
}
return true
case "pageHeader":
case "pageFooter":
if (!isSingleSelection) return false
case "section":
case "body":
showFeedbackElem(d,false)
p.deselectAll(bid)
p.selectSingle(bid)
if (isRealDD && e.dataTransfer) {
e.dataTransfer.dropEffect='copy'
}
return true
}
return false
    }
    function reportDropCB(lyr,cn,cellZone)
    {
p._isDDEnabled=false
var bid = lyr.getAttribute?lyr.getAttribute("bid"):null
if (bid == null) return
p._curIdRef=lyr.getAttribute?lyr.getAttribute("idref"):null
p._curIdRefBid=bid
var items = dicTree.getSelections()
var nItems = items.length
var isSingleSelection = (nItems == 1)
var IDArr = new Array()
for (var i = 0, c=0; i < nItems; i++) {
var data = items[i].userData
if (data == null) return
if (data.getVariableID()) { 
IDArr[c++] = data.getVariableID()
}
}
var IDs = "[" + IDArr.join(",") + "]"
fr = getTopFrameset(self).getReportFrame()
d = fr.document
showFeedbackElem(d,false)
var bUseAxisAPI=false
var elt = p.findByBID(p.doc,bid)
if (!elt) return
var insertion = false
if ((cn=="tableCell")||(cn=="reportCell")||(cn=="cell"))
{
if (cn=="tableCell")
{
var zone=elt.parent,zcn=zone.className, pcn=elt.parent.parent.className
if (((pcn=="vTable") || (pcn=="hTable")) && (zcn.substring(0,1)=="h")) { 
var zp=zone.parent, r=elt.row + ((cellZone==p._cellBottom)?(elt.rowSpan-1):0), c = elt.col + ((cellZone==p._cellRight)?(elt.colSpan-1):0) 
for (var i=0; i < zp.children.length; i++)
{
var sub=zp.children[i] 
if (sub.className=="b") { 
for (var j=0; j < sub.children.length; j++)
{
var e=sub.children[j]
var row = e.row 
var col = e.col
if ((r >= row) && (r <=(row + (e.rowSpan-1))) && (c >= col) && (c <= (col + (e.colSpan-1)))) { 
elt = e
zone = sub
zcn = "b"
bid = e.bid
break
}
}
break
}
}
}
if ((zcn=="b")||(zcn=="b,h-1")||(zcn=="h-1,b"))
{
var axis=zone.parent.parent.axis[zone.axis]
bUseAxisAPI=p.isInAxis(axis,elt)
var pcn=elt.parent.parent.className
var vertIns=(cellZone==p._cellBottom)||(cellZone==p._cellTop)
var horiIns=(cellZone==p._cellRight)||(cellZone==p._cellLeft)
insertion = vertIns || horiIns
if ((pcn=="vTable")&&vertIns)
bUseAxisAPI=false
if ((pcn=="hTable")&&horiIns)
bUseAxisAPI=false
if (pcn=="crossTable")
{
if ((zcn=="b")&&vertIns)
bUseAxisAPI=false
if ((zcn=="b,h-1")&&vertIns)
bUseAxisAPI=false
if ((zcn=="h-1,b")&&horiIns)
bUseAxisAPI=false
}
}
var blockL= p.getParentLayerFromBid(lyr,p.getTableCellParentBID(elt))
if (blockL)
p._curIdRef=blockL.getAttribute("idref")
else
p._curIdRef=null
}
if (isSingleSelection && !insertion) 
{
if((cn!="reportCell") && (data.id==elt.id))
    return;
if((cn=="reportCell") && (data.formula==elt.formula))
    return;
}
if (cn=="reportCell")
{
if ((elt.isSect)&&(items[0].userData.kind != _msr)) 
bUseAxisAPI=true
cellZone=null 
if(elt.isSect)
{
var sectionL= p.getParentLayerFromBid(lyr,p.getSectionCellParentBID(elt),true)
if (sectionL)
p._curIdRef=sectionL.getAttribute("idref")
else
p._curIdRef=null
}
}
if (bUseAxisAPI)
{
var params=p.urlParamsNoBID()
var zoneParam=(cellZone!=null)?("&nZone="+cellZone):''
p.wt()
p.frameNav("Report",p._root+"processAddReplace"+p._appExt+params+"&sBid="+convURL(bid)+"&sNewVarIds="+convURL(IDs)+"&sReason=replace"+zoneParam ,true)
}
else
{
var params=p.urlParamsNoBID()+"&bids="+convURL(bid)
var sDirection=null,iAction=null,iWhere=null
if (cellZone==p._cellBottom)
{
sDirection="below"
iAction="0" 
iWhere= elt.row + (elt.rowSpan-1)
}
else if (cellZone==p._cellTop)
{
sDirection="above"
iAction="0" 
iWhere= elt.row + (elt.rowSpan-1)
}
else if (cellZone==p._cellLeft)
{
sDirection="left"
iAction="2" 
iWhere = elt.col + (elt.colSpan-1)
}
else if (cellZone==p._cellRight)
{
sDirection="right"
iAction="2" 
iWhere = elt.col + (elt.colSpan-1)
}
if (sDirection)
{
p.wt()
p.frameNav("Report",p._root+"processRowCol"+p._appExt+params+"&sBid="+convURL(bid)+"&iAction="+iAction+"&sDir="+sDirection+"&sVarID="+convURL(IDArr[0])+"&nAction=4"+"&nRow="+elt.row+"&nCol="+elt.col,true)
}
else
{
p.wt()
p.frameNav("Report",p._root+"processFormula"+p._appExt+params+"&sVarID="+convURL(IDArr[0])+"&nAction=4",true)
}
}
}
else 
{
var xybid = p.getClickCoordinates()
params=p.urlParamsNoBID()
p.wt()
params += "&sBid="+convURL(bid)+"&sNewVarIds="+convURL(IDs)+"&sUnitIsInch=" + p._unitIsInch + "&sX=" + xybid.x + "&sY=" + xybid.y + "&sRow="+ p._row
p.frameNav("Report",p._root+"processInsertCell"+p._appExt+params,true)
}
}
function DDInitAction(lyr,cn,zone)
{
var acceptDD = reportAcceptDropCB(lyr,cn,zone,true) 
var isDDFeedback = (lyr.id == "__DD_Feedback") 
p._DDTxt= "No action is allowed here." + " " + "(Presse Esc  to cancel this action)"
if (isDDFeedback) {
p._DDTxt= _selTxt + " " + "Replace with object" + " " + "(Presse Esc  to cancel this action)"
} else if (acceptDD) {
p._DDTxt= _selTxt + " " + "Drop object here" + " " + "(Presse Esc  to cancel this action)"
} else {
_lyr = null
}
}
function DDExecuteAction()
{
if (_lyr!=null)
{
reportDropCB(_lyr,_cn,_zone)
}
else
{
p._isDDEnabled=false
}
insertBt.check(false)
}
function dclickCB(data)
{
p.escapeFormatPainter()
if (!(data)) return false
if (data.isVariable) 
{
if (p.isEnableUserRight(p._usrUseFormula))
editFormulaCB()
} else if (data.DPNames) {
if (p.isEnableUserRight(p._usrCreateMergeDimension))
mergePropCB(data)
}
return false
}
    function editFormulaCB()
    {
p.escapeFormatPainter()
p.formulaEdition=true
p.wt()
p.frameNav('DlgFrame',p._root+'language/' + p._lang + '/html/variableEditorDialog.html?fromLPane=yes')
    }
    function rmFormulaCB()
    {        
p.escapeFormatPainter()
        p.showPromptDialog("Are you sure you want to delete this variable?" , "Remove Variable", p._promptDlgWarning,doRmFormula)
    }
    function deleteCB(data)
    {
if (data && data.isVariable)
{
if (p.isEnableUserRight(p._usrUseFormula))
rmFormulaCB()
}
    }
    function doRmFormula()
    {        
var selItems = dicTree.getSelections()
var data=selItems[0].userData,n=data.name
p.eventManager.notify(p._EVT_VARS_UPDATE)
var url = p._root + "processFormulaDeletion" + p._appExt
url += p.urlParams(false, true) 
url += "&sName=" + p.convURL(n)
p.wt()
p.frameNav('Report',url)
    }
    function addFormulaCB()
    {
p.escapeFormatPainter()
p.formulaEdition=false
p.wt()
p.frameNav('DlgFrame',p._root+'language/' + p._lang + '/html/variableEditorDialog.html?fromLPane=yes')
    }
mergeAction=null
selID=null
selName=null
selDesc=null
arraySources=new Array
_data= null
function newSourceObject(id,name,shortName,desc) {
var o=new Object
o.id=id
o.name=name
o.shortName=shortName
o.desc=desc
return o
}
function mergePropCB(data)
{
data = data?data:_data
selID=data.id
selName=data.name
selDesc=data.desc
if (!(window._singleSel)) return
var list = _singleSel.sub, len=list.length
for (var i = 0; i < len; i++) {
var subData = list[i].userData
arraySources[i] = newSourceObject(subData.id,subData.name,subData.shortName,subData.desc)
}
p.frameNav('DlgFrame',p._root+'language/' + p._lang + '/html/mergeDimPropertiesDialog.html')
}
    function mergeCB()
    {
p.escapeFormatPainter()
sel=dicTree.getSelections(), len=sel.length, sDimensionIDs=""
if (mergeAction=="merge") {
for (var i=0; i < len; i++) {
        var data = sel[i].userData        
if ((data.DPNames) || (data.kind == _msr)) return
sDimensionIDs += data.id
if (i < (len-1)) sDimensionIDs += ","
}
processMerge()
} else if (mergeAction=="unmerge") {
sDimensionIDs = sel[0].userData.id
p.showPromptDialog("By removing this merged dimension you will remove all instances of it from the report. Are you sure you want to continue?","Remove Merged Dimension",p._promptDlgWarning, processMerge, noUnmergeCB)
} 
}
function processMerge()
{
p.eventManager.notify(p._EVT_VARS_UPDATE)
var url = p._root + "processMergeDimensions" + p._appExt
url += p.urlParamsNoBID() 
url += "&sDimensionIDs=" + sDimensionIDs + "&sMergeAction=" + mergeAction
p.wt()
mergeAction= null
p.frameNav('Report',url)       
    }
    function noUnmergeCB()
    {
    }
    function updateBtns()
    {
insertBt.setDisabled(true)
mergeDimBt.changeText("Merge")
mergeDimBt.changeTooltip("Merge the selected dimensions into a merged dimension")
mergeDimBt.setDisabled(true)
var canMerge= false
var sel=dicTree.getSelections()
var len=sel.length
if (len==0) return
if (len == 1)
{
var data=sel[0].userData
if (data) 
{
insertBt.setDisabled(false)
if (data.isVariable) {
editMenu.setDisabled(false)
rmMenu.setDisabled(false)
} else if (data.DPNames) {
mergeDimBt.changeText("Unmerge")
mergeDimBt.changeTooltip("Unmerge the selected dimension")
mergeAction="unmerge"
canMerge=true
}
}
} else { 
insertBt.setDisabled(!canDragDrop())
mergeAction="merge"
        var data = sel[0].userData
        if ( !(data) || !(data.DPName) ||(data.DPNames) || (data.isPartOfALinkedDim) || (data.kind == _msr) || (data.kind == _dtl)) return
        var dataType = data.dataType
        var arrDPNames= new Array
        arrDPNames[data.DPName] = true
        for (var i=1; i < len; i++) {
        var data = sel[i].userData        
        if ( !(data) || !(data.DPName) || (data.DPNames) || (data.isPartOfALinkedDim) || (data.kind == _msr) || (data.kind == _dtl) || (data.dataType != dataType)) return
if (arrDPNames[data.DPName]) {
canMerge=false
break
}
arrDPNames[data.DPName] = true
canMerge=true
        }
}
mergeDimBt.setDisabled(!canMerge)
    }
    function resizeCB()
    {
        if (isPageLoaded)
        {            
dicTree.move( 0, _toolbarYOffset)
dicTree.resize( Math.max(0,winWidth()+(_moz?4:0)), Math.max(0,winHeight()- (_toolbarYOffset + (_moz?-4:0))))
updateBtns()
    }
    }
function buildTree(tree,withFormula)
{
tree.deleteAll()
setListOrder()
_docObjects.sort(sortFuncUsingListOrder) 
renameSameNameDifferentDPObj()
newTreeElt1 = newTreeWidgetElem(1,"Available Objects", null,null,null, "Available Objects");
tree.add(newTreeElt1);
var len = _docObjects.length
if (len>0)
{
for (var i=0; i < len; i++)
{
var item =_docObjects[i]
if (item.isPartOfALinkedDim) continue
switch(item.kind) 
{
case _linkDim:
var l = item.linkedIDs.length
for (var k=0; k < l; k++) {
for (var m=0; m < len ; m++) {
var el = _docObjects[m]
if (el.isPartOfALinkedDim) continue
if (el.id == item.linkedIDs[k]) {
_docObjects[m].isPartOfALinkedDim = true
}
}
}
break;
}
}
len = _docObjects.length
for (var i=0; i < len; i++)
{
var item =_docObjects[i]
if (item.isPartOfALinkedDim) continue
var sTooltipHdr = "Based On:"
var sTooltipDesc = "Description:"
tooltipType = "Type:" +  " " + p._labDataType[item.dataType];
if(item.kind == _msr)
tooltipAggr = "\n"+ "Aggregation:"+ " " + p.getAggregationLabel(item.aggregateFct);
else
tooltipAggr="";
switch(item.kind) 
{
case _dim:
case _msr:
case _dtl:
tooltipDesc = (item.desc)? ("\n" + sTooltipDesc + " " + item.desc) : ""
tooltip = sTooltipHdr + " " + item.DPName + '\n'+ tooltipType + tooltipAggr + tooltipDesc
newTreeElt1.add(newTreeWidgetElem(item.kind, item.name, item, null,null, shrinkTooltip(tooltip)));
break;
case _linkDim:
mergedTooltip = ""
mergedTooltipDesc = ""
mergedTooltipType = tooltipType
nLinkDim = newTreeWidgetElem(_linkDim, item.name, item, null,null, "")
newTreeElt1.add(nLinkDim);
var l = item.linkedIDs.length
for (var k=0; k < l; k++) { 
for (var m=0; m < len ; m++) {
var el = _docObjects[m]
if (el.id == item.linkedIDs[k]) {
tooltipType = "Type:" +  " " + p._labDataType[el.dataType] ;
tooltipDesc = (el.desc)? ("\n" + sTooltipDesc + " " + el.desc) : ""
tooltip = sTooltipHdr + " " + el.DPName + '\n'+ tooltipType+ tooltipDesc
el.name = el.shortName + "(" + el.DPName + ")"
nLinkDim.add(newTreeWidgetElem(el.kind, el.name, el, null,null, shrinkTooltip(tooltip)))
mergedTooltip += el.DPName
if (k < (l-1)) mergedTooltip += ", "
}
}
}
mergedTooltipDesc = (item.desc)? ("\n" + sTooltipDesc + " " + item.desc) : ""
nLinkDim.tooltip = shrinkTooltip( sTooltipHdr + " " + mergedTooltip + '\n'+ mergedTooltipType+ mergedTooltipDesc)
break;
}
}
}
newTreeElt1.expanded = p._resultObjsBranchExp
_variableObjects.sort(BOObj_sortFunc)
newTreeElt2 = newTreeWidgetElem(1,"Variables", null,null,null, "Variables");
tree.add(newTreeElt2);
var len = _variableObjects.length
if (len>0)
{
for (var i=0; i < len; i++)
{
var item = _variableObjects[i]
item.isVariable=true
tooltipType = "Type:" +  " " + p._labDataType[item.dataType];
tooltipDesc = (item.formula)? ("\n" + item.formula) : ""
var itemToolTip = shrinkTooltip( tooltipType + tooltipDesc)
newTreeElt2.add(newTreeWidgetElem(item.kind, item.name, item, null, null, itemToolTip));
}
}
newTreeElt2.expanded = p._varsBranchExp
if (withFormula) 
{
_formulaObjects.sort(BOObj_sortFunc)
var len = _formulaObjects.length
if (len>0)
{
newTreeElt3 = newTreeWidgetElem(1,"Formulas",null, null,null, "Formulas");
tree.add(newTreeElt3);
for (var i=0; i < len;i++)
{
var item = _formulaObjects[i]
item.isFormula=true
tooltipType = "Type:" +  " " + p._labDataType[item.dataType];
tooltipDesc = (item.desc)? ("\n" + item.desc) : ""
var itemToolTip = shrinkTooltip( tooltipType + tooltipDesc)
newTreeElt3.add(newTreeWidgetElem(item.kind, item.name, item, null, null, itemToolTip));
}
newTreeElt3.expanded = p._formulaeBranchExp
}
}
tree.rebuildHTML()
}
function writeMyBody()
{
if (_error) return
var s = new Array()
var i=0
if (_showToolbar) {
s[i++] = varsToolbar.getHTML()
s[i++] = '<div class=treeZone style="height:'+(_ie?1:0)+'px;overflow:hidden;position:absolute;top:24px;left:0px;width:100%;border-top-width:0px;border-left-width:0px;border-right-width:0px;"></div>'
}
s[i++] = dicTree.getHTML()
document.write(s.join(""))
}
function addIcn(a,b,c,d,e)
{
return varsToolbar.add(newIconWidget(a,(b!=null)?_img+curIcon:null,e,c,d,16,16,b?b*16:0,0,b?b*16:0,16))
}
function addCheckIcn(a,b,c,d,e)
{
return varsToolbar.add(newIconCheckWidget(a,(b!=null)?_img+curIcon:null,e,c,d,16,16,b?b*16:0,0,b?b*16:0,16))
}
function addIcnM(a,b,c,d,e,beforeShowCB)
{
return varsToolbar.add(newIconMenuWidget(a,(b!=null)?_img+curIcon:null,e,c,d,(b!=null)?16:1,16,b?b*16:0,0,b?b*16:0,16,null,beforeShowCB))
}
function sp()
{
return varsToolbar.add()
}        
function showContextMenu(id, ev)
{
p.escapeFormatPainter()
var pos = getPos(p.lPaneWidget.layer),x,y
ev = _ie?_curWin.event:ev
x=absxpos(ev)+pos.x
y=absypos(ev)+pos.y
resultObjectsContextMenu.show(true,x,y)
}
    function lPaneContextMenu()
{
return false;
}
</script>        
</head>
<body class="dialogzone"  style="overflow:hidden;" marginheight="0" marginwidth="0" leftmargin="0" topmargin="0" onLoad="loadCB()" onUnload="detachEvents()" onresize="resizeCB()" oncontextmenu="return lPaneContextMenu();">
<script language="javascript">writeMyBody()</script>
</body>
</html>
